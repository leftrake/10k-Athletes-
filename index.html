<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10k Athletes Challenge</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        input {
            padding: 10px;
            width: 300px;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #info-section, #game-section, #leaderboard-section {
            display: none;
        }
        #response {
            margin-top: 20px;
            font-weight: bold;
        }
        ul {
            text-align: left;
            display: inline-block;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            width: 90%;
        }
    </style>
</head>
<body>
    <h1>10k Athletes Challenge</h1>

    <div id="login-section">
        <p>Log in or register to start:</p>
        <input type="email" id="player-email" placeholder="Enter your email" />
        <input type="password" id="player-password" placeholder="Enter your password" />
        <button id="register-button">Register</button>
        <button id="login-button">Log In</button>
    </div>

    <div id="info-section">
        <h2>Welcome to the 10k Athletes Challenge!</h2>
        <p>How to Play:</p>
        <ul>
            <li>Enter the names of as many <strong>professional athletes</strong> as you can think of.</li>
            <li><strong>Names must be spelled exactly correct</strong>, but the game is case-insensitive.</li>
            <li>
                Correct punctuation and diacritical marks are required:
                <ul>
                    <li>Example: <strong>T.J. McConnell</strong> will work, but <strong>TJ McConnell</strong> will not.</li>
                    <li>Example: <strong>Nikola JokiÄ‡</strong> will work, but <strong>Nikola Jokic</strong> will not.</li>
                </ul>
            </li>
            <li>Only <strong>current professional athletes</strong> from mainstream sports are valid.</li>
            <li>Each correct name earns 10 points, which are tracked on the leaderboard.</li>
        </ul>
        <button id="start-game-button">Start Game</button>
    </div>

    <div id="game-section">
        <p>Enter a professional athlete's name below:</p>
        <input type="text" id="athlete-name" placeholder="Enter athlete name..." />
        <button id="submit-button">Submit</button>
        <button id="reset-button">Reset</button>
        <button id="back-to-info-button">Back to Information Page</button>
        <p id="response"></p>
        <h2>Your Score: <span id="score">0</span></h2>
        <h3>Named Athletes:</h3>
        <ul id="named-athletes"></ul>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBK6K_mqI83trEQxbdHDRCjLn0FB5DygrE",
            authDomain: "k-athletes-challenge.firebaseapp.com",
            databaseURL: "https://k-athletes-challenge-default-rtdb.firebaseio.com",
            projectId: "k-athletes-challenge",
            storageBucket: "k-athletes-challenge.firebasestorage.app",
            messagingSenderId: "772472944883",
            appId: "1:772472944883:web:74a957e39b96d108745f86"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentPlayer = "";
        let score = 0;
        let namedAthletes = new Set();

        document.getElementById("register-button").addEventListener("click", async () => {
            const email = document.getElementById("player-email").value.trim();
            const password = document.getElementById("player-password").value.trim();

            if (!email || !password) {
                alert("Please enter both email and password to register.");
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                currentPlayer = userCredential.user.uid;

                const playerRef = ref(db, `players/${currentPlayer}`);
                await set(playerRef, { score: 0, namedAthletes: [] });

                alert(`Registration successful for ${email}. You are now logged in.`);
                document.getElementById("login-section").style.display = "none";
                document.getElementById("info-section").style.display = "block";
            } catch (error) {
                console.error("Error during registration:", error);
                alert("Registration failed. Please try again.");
            }
        });

        document.getElementById("login-button").addEventListener("click", async () => {
            const email = document.getElementById("player-email").value.trim();
            const password = document.getElementById("player-password").value.trim();

            if (!email || !password) {
                alert("Please enter both email and password to log in.");
                return;
            }

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                currentPlayer = userCredential.user.uid;

                const playerRef = ref(db, `players/${currentPlayer}`);
                const snapshot = await get(playerRef);

                if (snapshot.exists()) {
                    const data = snapshot.val();
                    score = data.score || 0; // Retrieve and keep the player's score
                    namedAthletes = new Set(data.namedAthletes || []);
                    updateNamedAthletesUI();
                    document.getElementById("score").textContent = score; // Update score in the UI
                    alert(`Welcome back, ${email}!`);
                } else {
                    alert(`No data found for ${email}. Starting a new game.`);
                }

                document.getElementById("login-section").style.display = "none";
                document.getElementById("info-section").style.display = "block";
            } catch (error) {
                console.error("Error during login:", error);
                alert("Login failed. Please check your email and password.");
            }
        });

        document.getElementById("start-game-button").addEventListener("click", () => {
            document.getElementById("info-section").style.display = "none";
            document.getElementById("game-section").style.display = "block";
        });

        document.getElementById("back-to-info-button").addEventListener("click", () => {
            document.getElementById("game-section").style.display = "none";
            document.getElementById("info-section").style.display = "block";
        });

        document.getElementById("submit-button").addEventListener("click", async () => {
            const athleteName = document.getElementById("athlete-name").value.trim();
            const responseElement = document.getElementById("response");

            if (athleteName === "") {
                responseElement.textContent = "Please enter a name!";
                responseElement.style.color = "red";
                return;
            }

            if (namedAthletes.has(athleteName.toLowerCase())) {
                responseElement.textContent = `${athleteName} has already been named!`;
                responseElement.style.color = "blue";
                return;
            }

            try {
                const response = await fetch(`https://www.thesportsdb.com/api/v1/json/3/searchplayers.php?p=${athleteName}`);
                const data = await response.json();

                if (data && data.player) {
                    const exactMatch = data.player.find(player => player.strPlayer.toLowerCase() === athleteName.toLowerCase());
                    if (exactMatch) {
                        namedAthletes.add(exactMatch.strPlayer.toLowerCase());
                        addNamedAthleteToUI(exactMatch.strPlayer);

                        score += 10; // Increment score by 10 points
                        document.getElementById("score").textContent = score;

                        const playerRef = ref(db, `players/${currentPlayer}`);
                        await update(playerRef, { score, namedAthletes: Array.from(namedAthletes) });

                        responseElement.textContent = `${exactMatch.strPlayer} is valid!`;
                        responseElement.style.color = "green";
                    } else {
                        responseElement.textContent = `${athleteName} is not valid.`;
                        responseElement.style.color = "orange";
                    }
                } else {
                    responseElement.textContent = `${athleteName} is not valid.`;
                    responseElement.style.color = "orange";
                }
            } catch (error) {
                console.error("Error fetching athlete data:", error);
                responseElement.textContent = "Error validating athlete. Please try again.";
                responseElement.style.color = "red";
            }
        });

        document.getElementById("reset-button").addEventListener("click", () => {
            namedAthletes.clear();
            score = 0;
            document.getElementById("score").textContent = score;
            updateNamedAthletesUI();
            document.getElementById("response").textContent = "Game reset!";
        });

        function addNamedAthleteToUI(athleteName) {
            const list = document.getElementById("named-athletes");
            const listItem = document.createElement("li");
            listItem.textContent = athleteName;
            list.appendChild(listItem);
        }

        function updateNamedAthletesUI() {
            const list = document.getElementById("named-athletes");
            list.innerHTML = "";
            namedAthletes.forEach(athlete => addNamedAthleteToUI(athlete));
        }
    </script>
</body>
</html>
